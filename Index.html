import React, { useState } from 'react';
import { Button } from "/components/ui/button";
import { Input } from "/components/ui/input";
import { Textarea } from "/components/ui/textarea";
import {
  Card,
  CardContent,
  CardDescription,
  CardFooter,
  CardHeader,
  CardTitle,
} from "/components/ui/card";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";
import { Label } from "/components/ui/label";

const CartoonDreamStudio = () => {
  const [activeTab, setActiveTab] = useState('video');
  const [prompt, setPrompt] = useState('');
  const [videoLength, setVideoLength] = useState('30');
  const [voiceStyle, setVoiceStyle] = useState('cute');
  const [generatedContent, setGeneratedContent] = useState<string | null>(null);
  const [isLoading, setIsLoading] = useState(false);
  const [contentType, setContentType] = useState<'video' | 'image' | 'audio'>('video');

  const generateContent = async () => {
    if (!prompt.trim()) return;
    
    setIsLoading(true);
    setGeneratedContent(null);

    try {
      let model = '';
      let systemPrompt = '';

      switch (activeTab) {
        case 'video':
          model = 'replicate/google/veo-3';
          systemPrompt = `You are a professional cartoon video generator. Create a 3D cute cartoon video based on the user's prompt. Video length: ${videoLength} minutes. Style: colorful, cute, family-friendly.`;
          setContentType('video');
          break;
        case 'image':
          model = 'replicate/black-forest-labs/flux-1.1-pro';
          systemPrompt = 'You are a cartoon image generator. Create cute, 3D cartoon images based on the user prompt. Style: vibrant colors, cartoonish, adorable characters.';
          setContentType('image');
          break;
        case 'voice':
          // Use ElevenLabs for voice generation
          await generateVoice();
          setIsLoading(false);
          return;
      }

      if (activeTab !== 'voice') {
        const response = await fetch('https://oi-server.onrender.com/chat/completions', {
          method: 'POST',
          headers: {
            'CustomerId': '',
            'Content-Type': 'application/json',
            'Authorization': 'Bearer xxx'
          },
          body: JSON.stringify({
            model: model,
            messages: [
              {
                role: "system",
                content: systemPrompt
              },
              {
                role: "user",
                content: `Generate ${activeTab}: ${prompt}`
              }
            ]
          })
        });

        const data = await response.json();
        if (data.choices && data.choices[0]?.message?.content) {
          setGeneratedContent(data.choices[0].message.content);
        }
      }
    } catch (error) {
      console.error('Generation error:', error);
    } finally {
      setIsLoading(false);
    }
  };

  const generateVoice = async () => {
    try {
      const response = await fetch('https://elevenlabs-proxy-server.onrender.com/v1/text-to-speech/JBFqnCBsd6RMkjVDRZzb', {
        method: 'POST',
        headers: {
          'CustomerId': '',
          'Content-Type': 'application/json',
          'Authorization': 'Bearer xxx',
          'Accept': 'audio/mpeg'
        },
        body: JSON.stringify({
          text: prompt,
          model_id: "eleven_multilingual_v2",
          voice_settings: { 
            stability: 0.5, 
            similarity_boost: 0.8 
          }
        })
      });

      if (response.ok) {
        const audioBlob = await response.blob();
        const audioUrl = URL.createObjectURL(audioBlob);
        setGeneratedContent(audioUrl);
        setContentType('audio');
      }
    } catch (error) {
      console.error('Voice generation error:', error);
    }
  };

  const animateVideo = async () => {
    if (!generatedContent) return;
    
    setIsLoading(true);
    try {
      const response = await fetch('https://oi-server.onrender.com/chat/completions', {
        method: 'POST',
        headers: {
          'CustomerId': '',
          'Content-Type': 'application/json',
          'Authorization': 'Bearer xxx'
        },
        body: JSON.stringify({
          model: 'replicate/google/veo-3',
          messages: [
            {
              role: "system",
              content: "You are a video animation expert. Add cartoonish animations and effects to the provided video. Make it cute, colorful, and engaging."
            },
            {
              role: "user",
              content: `Animate this video with cartoon effects: ${generatedContent}`
            }
          ]
        })
      });

      const data = await response.json();
      if (data.choices && data.choices[0]?.message?.content) {
        setGeneratedContent(data.choices[0].message.content);
      }
    } catch (error) {
      console.error('Animation error:', error);
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50">
      {/* Header */}
      <header className="bg-white shadow-sm border-b">
        <div className="container mx-auto px-4 py-4">
          <div className="flex items-center justify-between">
            <div className="flex items-center space-x-2">
              <img 
                src="https://placeholder-image-service.onrender.com/image/48x48?prompt=cute%20cartoon%20dream%20studio%20logo%20with%20stars%20and%20magic%20sparkles&id=logo1" 
                alt="CartoonDream Studio logo featuring magical stars and sparkles" 
                className="w-12 h-12 rounded-lg"
              />
              <h1 className="text-2xl font-bold text-primary">CartoonDream Studio</h1>
            </div>
            <nav className="hidden md:flex space-x-6">
              <button className="text-foreground hover:text-primary">Home</button>
              <button className="text-foreground hover:text-primary">Features</button>
              <button className="text-foreground hover:text-primary">About</button>
              <button className="text-foreground hover:text-primary">Contact</button>
            </nav>
          </div>
        </div>
      </header>

      {/* Main Content */}
      <main className="container mx-auto px-4 py-8">
        {/* Hero Section */}
        <section className="text-center mb-12">
          <h2 className="text-4xl font-bold text-foreground mb-4">
            Create Magical Cartoon Content Instantly
          </h2>
          <p className="text-muted-foreground text-lg max-w-2xl mx-auto">
            Transform your ideas into adorable 3D cartoons with our free AI-powered studio. 
            Generate videos, images, and voices in seconds!
          </p>
        </section>

        {/* Generator Tabs */}
        <Card className="max-w-4xl mx-auto">
          <CardHeader>
            <div className="flex space-x-4 mb-4">
              <Button
                variant={activeTab === 'video' ? 'default' : 'outline'}
                onClick={() => setActiveTab('video')}
              >
                üé• Video Generator
              </Button>
              <Button
                variant={activeTab === 'image' ? 'default' : 'outline'}
                onClick={() => setActiveTab('image')}
              >
                üñºÔ∏è Image Generator
              </Button>
              <Button
                variant={activeTab === 'voice' ? 'default' : 'outline'}
                onClick={() => setActiveTab('voice')}
              >
                üîä Voice Generator
              </Button>
            </div>
            
            <CardTitle>
              {activeTab === 'video' && 'Create 3D Cartoon Videos'}
              {activeTab === 'image' && 'Generate Cute Cartoon Images'}
              {activeTab === 'voice' && 'Produce Cartoon Voiceovers'}
            </CardTitle>
            <CardDescription>
              {activeTab === 'video' && 'Generate up to 30 minutes of adorable 3D cartoon videos from text'}
              {activeTab === 'image' && 'Create beautiful cartoon images with detailed descriptions'}
              {activeTab === 'voice' && 'Generate cute cartoon character voices for your content'}
            </CardDescription>
          </CardHeader>

          <CardContent className="space-y-4">
            <div className="space-y-2">
              <Label htmlFor="prompt">Describe what you want to create</Label>
              <Textarea
                id="prompt"
                placeholder={
                  activeTab === 'video' ? 
                  "A cute puppy playing in a magical forest with butterflies..." :
                  activeTab === 'image' ?
                  "A cartoon cat wearing a wizard hat and holding a sparkling wand..." :
                  "Hello! Welcome to our magical cartoon world..."
                }
                value={prompt}
                onChange={(e) => setPrompt(e.target.value)}
                className="min-h-[100px]"
              />
            </div>

            {activeTab === 'video' && (
              <div className="space-y-2">
                <Label htmlFor="length">Video Length (minutes)</Label>
                <Select value={videoLength} onValueChange={setVideoLength}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select length" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="15">15 minutes</SelectItem>
                    <SelectItem value="30">30 minutes</SelectItem>
                    <SelectItem value="45">45 minutes</SelectItem>
                    <SelectItem value="60">60 minutes</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            )}

            {activeTab === 'voice' && (
              <div className="space-y-2">
                <Label htmlFor="voiceStyle">Voice Style</Label>
                <Select value={voiceStyle} onValueChange={setVoiceStyle}>
                  <SelectTrigger>
                    <SelectValue placeholder="Select voice style" />
                  </SelectTrigger>
                  <SelectContent>
                    <SelectItem value="cute">Cute & Playful</SelectItem>
                    <SelectItem value="magical">Magical & Mystical</SelectItem>
                    <SelectItem value="adventure">Adventure Hero</SelectItem>
                    <SelectItem value="comedy">Funny & Comedic</SelectItem>
                  </SelectContent>
                </Select>
              </div>
            )}

            <Button 
              onClick={generateContent} 
              disabled={isLoading || !prompt.trim()}
              className="w-full"
            >
              {isLoading ? 'Creating Magic...' : 'Generate Now ‚ú®'}
            </Button>
          </CardContent>

          {/* Results Section */}
          {generatedContent && (
            <CardFooter className="flex flex-col space-y-4">
              <div className="w-full">
                <h3 className="text-lg font-semibold mb-3">Your Creation</h3>
                
                {contentType === 'video' && (
                  <div className="space-y-3">
                    <div className="aspect-video bg-muted rounded-lg flex items-center justify-center">
                      <video 
                        src={generatedContent} 
                        controls 
                        className="w-full h-full rounded-lg"
                        aria-label="Generated cartoon video preview"
                      />
                    </div>
                    <Button onClick={animateVideo} variant="outline">
                      üé® Add Cartoon Animation
                    </Button>
                  </div>
                )}

                {contentType === 'image' && (
                  <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <img 
                      src={generatedContent} 
                      alt="Generated cute cartoon image with vibrant colors and adorable characters" 
                      className="w-full h-64 object-cover rounded-lg"
                    />
                    <img 
                      src="https://placeholder-image-service.onrender.com/image/400x300?prompt=alternative%20cartoon%20style%20variation%20with%20different%20character%20poses&id=img2" 
                      alt="Alternative cartoon style variation showing different character poses and expressions" 
                      className="w-full h-64 object-cover rounded-lg"
                    />
                  </div>
                )}

                {contentType === 'audio' && (
                  <div className="space-y-3">
                    <audio 
                      src={generatedContent} 
                      controls 
                      className="w-full"
                      aria-label="Generated cartoon voice audio preview"
                    />
                    <div className="text-sm text-muted-foreground">
                      Your cartoon voiceover is ready! Download or share it below.
                    </div>
                  </div>
                )}

                <div className="flex space-x-3 mt-4">
                  <Button variant="outline">Download</Button>
                  <Button variant="outline">Share</Button>
                  <Button variant="outline">Create Another</Button>
                </div>
              </div>
            </CardFooter>
          )}
        </Card>

        {/* Features Grid */}
        <section className="grid grid-cols-1 md:grid-cols-3 gap-6 mt-16">
          <Card>
            <CardHeader>
              <CardTitle>Free Forever</CardTitle>
              <CardDescription>No hidden costs, no subscriptions</CardDescription>
            </CardHeader>
            <CardContent>
              <img 
                src="https://placeholder-image-service.onrender.com/image/300x200?prompt=free%20cartoon%20content%20creation%20with%20happy%20characters&id=feature1" 
                alt="Free cartoon content creation service with happy characters celebrating" 
                className="w-full h-48 object-cover rounded-lg mb-4"
              />
              <p>Everything you need to create amazing cartoon content, completely free of charge.</p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>3D Quality</CardTitle>
              <CardDescription>Professional cartoon animations</CardDescription>
            </CardHeader>
            <CardContent>
              <img 
                src="https://placeholder-image-service.onrender.com/image/300x200?prompt=high%20quality%203d%20cartoon%20rendering%20with%20depth%20and%20detail&id=feature2" 
                alt="High quality 3D cartoon rendering showing depth and detailed character design" 
                className="w-full h-48 object-cover rounded-lg mb-4"
              />
              <p>Studio-quality 3D animations that bring your stories to life with incredible detail.</p>
            </CardContent>
          </Card>

          <Card>
            <CardHeader>
              <CardTitle>Easy to Use</CardTitle>
              <CardDescription>Simple interface, powerful results</CardDescription>
            </CardHeader>
            <CardContent>
              <img 
                src="https://placeholder-image-service.onrender.com/image/300x200?prompt=user%20friendly%20cartoon%20creation%20interface%20with%20simple%20controls&id=feature3" 
                alt="User-friendly cartoon creation interface with simple controls and clear instructions" 
                className="w-full h-48 object-cover rounded-lg mb-4"
              />
              <p>No technical skills needed. Just describe your idea and let our AI do the magic.</p>
            </CardContent>
          </Card>
        </section>
      </main>

      {/* Footer */}
      <footer className="bg-muted mt-16 py-12">
        <div className="container mx-auto px-4">
          <div className="grid grid-cols-1 md:grid-cols-4 gap-8">
            <div>
              <h3 className="font-semibold mb-4">CartoonDream Studio</h3>
              <p className="text-muted-foreground">Creating magical cartoon experiences for everyone.</p>
            </div>
            <div>
              <h4 className="font-semibold mb-4">Features</h4>
              <ul className="space-y-2 text-muted-foreground">
                <li>Video Generation</li>
                <li>Image Creation</li>
                <li>Voice Production</li>
                <li>Animation Tools</li>
              </ul>
            </div>
            <div>
              <h4 className="font-semibold mb-4">Support</h4>
              <ul className="space-y-2 text-muted-foreground">
                <li>Help Center</li>
                <li>Tutorials</li>
                <li>Community</li>
                <li>Contact Us</li>
              </ul>
            </div>
            <div>
              <h4 className="font-semibold mb-4">Legal</h4>
              <ul className="space-y-2 text-muted-foreground">
                <li>Privacy Policy</li>
                <li>Terms of Service</li>
                <li>Copyright</li>
                <li>Guidelines</li>
              </ul>
            </div>
          </div>
          <div className="border-t mt-8 pt-8 text-center text-muted-foreground">
            <p>¬© 2024 CartoonDream Studio. All rights reserved.</p>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default CartoonDreamStudio;
